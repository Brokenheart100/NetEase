<UserControl x:Class="NetEase.Views.Components.PlayerControlView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:NetEase.Views.Components"
             xmlns:viewmodels="clr-namespace:NetEase.ViewModels"
             d:DataContext="{d:DesignInstance Type=viewmodels:PlayerControlViewModel}"
             mc:Ignorable="d"
             d:DesignHeight="150"
             d:DesignWidth="1000">
    <UserControl.Resources>
        <!-- 定义透明背景的图标按钮样式 -->
        <Style x:Key="IconButtonStyle"
               TargetType="Button">
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="Foreground"
                    Value="#CCCCCC"/>
            <Setter Property="BorderThickness"
                    Value="0"/>
            <Setter Property="Width"
                    Value="32"/>
            <Setter Property="Height"
                    Value="32"/>
            <Setter Property="FontSize"
                    Value="18"/>
            <Setter Property="FontFamily"
                    Value="Segoe MDL2 Assets"/>
            <Setter Property="Cursor"
                    Value="Hand"/>
            <Setter Property="Margin" 
                    Value="0,0,20,0"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver"
                         Value="True">
                    <Setter Property="Foreground"
                            Value="White"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- 将此样式放在 UserControl.Resources 或 Application.Resources 中 -->
        <Style x:Key="HoverEffectSliderStyle" TargetType="{x:Type Slider}">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#EC4141"/>
            <!-- 进度条已填充部分的颜色 -->
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Slider}">
                        <Grid x:Name="grid" VerticalAlignment="Center">
                         
                            <Track x:Name="PART_Track">
                                <Track.Thumb>
                                    <Thumb x:Name="SliderThumb" Background="{TemplateBinding Foreground}" Opacity="0">
                                        <Thumb.Style>
                                            <Style TargetType="{x:Type Thumb}">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="{x:Type Thumb}">
                                                            <!-- Thumb 的外观：一个简单的圆形 -->
                                                            <Ellipse Fill="{TemplateBinding Background}" Width="12" Height="12"/>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </Thumb.Style>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>

                            <!-- 进度条的视觉表现 -->
                            <Grid IsHitTestVisible="False">
                                <!-- 1. 轨道背景 (灰色部分) -->
                                <Border x:Name="TrackBackground" 
                                Height="4" 
                                Background="#555555" 
                                CornerRadius="2"/>

                                <!-- 2. 进度条已填充部分 (红色部分) -->
                                <!-- PART_SelectionRange 也是一个必要的命名，Slider的逻辑会自动管理它的宽度 -->
                                <Border x:Name="PART_SelectionRange" 
                                Height="4"
                                HorizontalAlignment="Left" 
                                Background="{TemplateBinding Foreground}"
                                CornerRadius="2"/>
                            </Grid>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <!-- 当鼠标悬浮在 Slider 上时触发 -->
                            <Trigger Property="IsMouseOver" Value="True">
                                <!-- 进入悬浮状态的动画 -->
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <!-- 轨道背景变粗 -->
                                            <DoubleAnimation Storyboard.TargetName="TrackBackground" 
                                                     Storyboard.TargetProperty="Height"
                                                     To="8" Duration="0:0:0.2"/>
                                            <!-- 进度条填充部分也变粗 -->
                                            <DoubleAnimation Storyboard.TargetName="PART_SelectionRange" 
                                                     Storyboard.TargetProperty="Height"
                                                     To="8" Duration="0:0:0.2"/>
                                            <!-- 拖动圆点淡入显示 -->
                                            <DoubleAnimation Storyboard.TargetName="SliderThumb" 
                                                     Storyboard.TargetProperty="Opacity"
                                                     To="1" Duration="0:0:0.2"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>
                                <!-- 离开悬浮状态的动画 -->
                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <!-- 轨道背景恢复原样 -->
                                            <DoubleAnimation Storyboard.TargetName="TrackBackground" 
                                                     Storyboard.TargetProperty="Height"
                                                     To="4" Duration="0:0:0.2"/>
                                            <!-- 进度条填充部分也恢复原样 -->
                                            <DoubleAnimation Storyboard.TargetName="PART_SelectionRange" 
                                                     Storyboard.TargetProperty="Height"
                                                     To="4" Duration="0:0:0.2"/>
                                            <!-- 拖动圆点淡出消失 -->
                                            <DoubleAnimation Storyboard.TargetName="SliderThumb" 
                                                     Storyboard.TargetProperty="Opacity"
                                                     To="0" Duration="0:0:0.2"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid ShowGridLines="True">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <!-- 进度条，使用Grid覆盖在最上层 -->
        <Grid VerticalAlignment="Top"
              Height="20"
              Margin="0,1,0,0"
              ShowGridLines="True">
            <Slider Grid.Row="0"
                    Style="{StaticResource HoverEffectSliderStyle}"
                    Value="{Binding CurrentProgress}"
                    Maximum="100"
                    VerticalAlignment="Center"
                    Margin="5,0"
                    ToolTip="{Binding CurrentTime}"
                    PreviewMouseDown="Slider_PreviewMouseDown"
                    PreviewMouseUp="Slider_PreviewMouseUp"/>
        </Grid>

        <!-- 主控制区域 -->
        <Grid Grid.Row="1" Margin="20"
              ShowGridLines="True">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <!-- 左侧：当前歌曲信息 -->
            <StackPanel Grid.Column="0"
                        Orientation="Horizontal"
                        VerticalAlignment="Center">
                <Border Width="70"
                        Height="70"
                        CornerRadius="4">
                    <Border.Background>
                        <ImageBrush ImageSource="{Binding CurrentSong.CoverImageUrl}"
                                    Stretch="UniformToFill"/>
                    </Border.Background>
                </Border>
                <StackPanel VerticalAlignment="Center"
                            Margin="10,0,0,0">
                    <TextBlock Text="{Binding CurrentSong.Title}"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Foreground="White"/>
                    <TextBlock Text="{Binding CurrentSong.Artist}"
                               FontSize="12"
                               Foreground="#888888"/>
                </StackPanel>
                <Button Content=""
                        Style="{StaticResource IconButtonStyle}"
                        ToolTip="喜欢"
                        Margin="10,0,0,0"/>
            </StackPanel>

            <!-- 中间：播放控制按钮 -->
            <StackPanel Grid.Column="1"
                        Orientation="Horizontal"
                        VerticalAlignment="Center">
                <Button Content=""
                        Style="{StaticResource IconButtonStyle}"
                        ToolTip="播放模式"
                        Margin="20,0,20,0"/>
                <Button Content=""
                        Style="{StaticResource IconButtonStyle}"
                        ToolTip="上一首"/>
                <Button Width="40"
                        Height="40"
                        Background="#EC4141"
                        Cursor="Hand"
                        Margin="0,0,15,0"
                        ToolTip="播放/暂停">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border Background="{TemplateBinding Background}"
                                    CornerRadius="20">
                                <TextBlock Text=""
                                           FontFamily="Segoe MDL2 Assets"
                                           FontSize="18"
                                           Foreground="White"
                                           VerticalAlignment="Center"
                                           HorizontalAlignment="Center"
                                           />
                            </Border>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
                <Button Content=""
                        Style="{StaticResource IconButtonStyle}"
                        ToolTip="下一首"/>
                <Button Content=""
                        Style="{StaticResource IconButtonStyle}"
                        ToolTip="播放列表"/>
            </StackPanel>

            <!-- 右侧：功能按钮 -->
            <StackPanel Grid.Column="2"
                        Orientation="Horizontal"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Right">
                <Button Content=""
                        Style="{StaticResource IconButtonStyle}"
                        ToolTip="本地"/>
                <Button Content=""
                        Style="{StaticResource IconButtonStyle}"
                        ToolTip="添加"/>
                <Button Content="词"
                        FontFamily="Microsoft YaHei UI"
                        FontSize="14"
                        Style="{StaticResource IconButtonStyle}"
                        ToolTip="歌词"/>
                <Button Content=""
                        Style="{StaticResource IconButtonStyle}"
                        ToolTip="音量"/>
                <Button Content=""
                        Style="{StaticResource IconButtonStyle}"
                        ToolTip="更多"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
